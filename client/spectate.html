<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Spectator View</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <h1>Live Race Results</h1>
  <div id="results">Loading...</div>

  <script>
    /* format 00:00:00 */
    function formatDuration(ms) {
      const t = Math.floor(ms / 1000);
      const h = String(Math.floor(t / 3600)).padStart(2, '0');
      const m = String(Math.floor((t % 3600) / 60)).padStart(2, '0');
      const s = String(t % 60).padStart(2, '0');
      return `${h}:${m}:${s}`;
    }

    async function fetchResults() {
      const sessionId = localStorage.getItem('currentResultsSession');
      if (!sessionId) {
        document.getElementById('results').textContent =
          'No race in progress.';
        return;
      }

      const res  = await fetch(`/results?sessionId=${sessionId}`);
      const data = await res.json();

      const box = document.getElementById('results');
      box.innerHTML = '';                               // clear old list

      if (data.length === 0) {
        box.textContent = 'No finishers yet.';
        return;
      }

      data.forEach(r => {
        const line = document.createElement('p');
        line.className = 'runner';
        line.textContent = `Runner ${r.runnerId} â€“ ${formatDuration(r.finish_time)}`;
        box.appendChild(line);
      });
    }

    fetchResults();               // first load
    setInterval(fetchResults, 15000);  // refresh every 15 s
  </script>
</body>
</html>